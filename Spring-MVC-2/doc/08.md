## 서블릿 필터와 스프링 인터셉터

“로그인을 하지않는 사용자도 URL을 직접 치면, 인증 없이도 상품 관리 페이지에 들어갈 수 있다 “ 

→ UI(화면)에서는 로그인 안 한 사용자에게 상품 관리 버튼을 안보여주고 있지만, 서버 URL은 누구나 접근 할 수 있게 열려있기 때문.

(localhost:8080/items) 하면 상품 목록이 보임.

** 그렇기 때문에 서버에서 이 사용자가 로그인 했는지 반드시 체크해야할 필요 근데 이 부분을 컨트롤러가 일일이 처리하는 것은 비효율적이기때문에 서블릿 필터 또는 스프링 인터셉터 방식을 사용 

| **비교 항목** | **서블릿 필터 (Filter)** | **스프링 인터셉터 (Interceptor)** |
| --- | --- | --- |
| 동작 위치 | 서블릿 컨테이너 레벨 (DispatcherServlet 이전) | 스프링 MVC 내부 (DispatcherServlet 이후) |
| 스프링 컨텍스트 접근 | 불가능 (스프링 빈 주입 불가) | 가능 (DI, 빈 주입 O) |
| 정교한 URL 매핑 | 상대적으로 불편 | addInterceptor()로 세밀하게 설정 가능 |
| Controller 정보 접근 | 없음 | HandlerMethod로 핸들러 정보 확인 가능 |
| 사용 목적 | 로깅, 인코딩, XSS 필터링 등 전역 처리 | 인증/인가, 로깅, 사용자 권한 등 **스프링 로직 관련 처리** |
| 실무 사용 빈도 | 낮음 (톰캣 공통 설정 등에서 사용) | **매우 높음** (인증/인가 핵심 처리에서 자주 사용) |

### 서블릿 필터 흐름

HTTP 요청 -> WAS -> 필터 -> 서블릿 -> 컨트롤러 //로그인 사용자

HTTP 요청 -> WAS -> 필터(적절하지 않은 요청이라 판단, 서블릿 호출X) //비 로그인 사용

### 스프링 인터셉조
![스프링 인터셉터 구조](https://github.com/user-attachments/assets/f16b4f48-4bd4-4897-b048-03ab785290e7)

- **preHandle**
    - 요청이 컨트롤러에 도달하기 **전**에 실행됨
    - 주로: **로그인 여부**, 인증, 로깅
    - false를 반환하면 컨트롤러 호출을 막고, 바로 응답(return) 처리 가능
- **핸들러 어댑터 / 핸들러 (컨트롤러)**
    - 실질적인 컨트롤러 실행을 위한 중간 단계 (핸들러 어댑터 → 핸들러 실행)
    - 컨트롤러에서 비즈니스 로직 처리
- **컨트롤러가 ModelAndView 객체 반환**
    - 모델과 뷰 이름을 가지고 DispatcherServlet으로 돌아감
- **postHandle**
    - 컨트롤러가 실행된 **직후**, 뷰 렌더링 **전**
    - 모델 정보나 뷰 이름을 수정하거나 로그 출력에 사용
- **DispatcherServlet이 View 호출 → 렌더링 수행**
    - 모델 데이터를 HTML로 렌더링
- **afterCompletion**
    - 뷰 렌더링 **후**, **모든 요청 처리 끝난 후** 실행됨
    - 예외 발생 여부와 관계없이 항상 실행됨
    - 주로: 자원 정리, 성능 측정 종료, 예외 로그 출력